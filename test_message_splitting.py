#!/usr/bin/env python3
"""
–¢–µ—Å—Ç —Ä–∞–∑–±–∏–≤–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from bot_handlers import split_long_message, clean_text_for_telegram

def test_message_splitting():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–±–∏–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    print("üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–±–∏–≤–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...")
    
    # –°–æ–∑–¥–∞–µ–º –¥–ª–∏–Ω–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    long_text = """
    –ü–õ–ê–ù –¢–†–ï–ù–ò–†–û–í–û–ö –ù–ê 4 –ù–ï–î–ï–õ–ò
    
    –ù–µ–¥–µ–ª—è 1: –ê–¥–∞–ø—Ç–∞—Ü–∏—è
    –î–µ–Ω—å 1 - –ì—Ä—É–¥—å –∏ —Ç—Ä–∏—Ü–µ–ø—Å:
    1. –ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 8-10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    2. –ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –Ω–∞–∫–ª–æ–Ω–Ω–æ–π —Å–∫–∞–º—å–µ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    3. –†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    4. –û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –±—Ä—É—Å—å—è—Ö - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 8-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    5. –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    6. –†–∞–∑–≥–∏–±–∞–Ω–∏—è —Ä—É–∫ –Ω–∞ –±–ª–æ–∫–µ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    
    –î–µ–Ω—å 2 - –°–ø–∏–Ω–∞ –∏ –±–∏—Ü–µ–ø—Å:
    1. –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ –º–∞–∫—Å–∏–º—É–º—É
    2. –¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 8-10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    3. –¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    4. –¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    5. –ü–æ–¥—ä–µ–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    6. –ú–æ–ª–æ—Ç–∫–∏ —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    
    –î–µ–Ω—å 3 - –ù–æ–≥–∏:
    1. –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π - 4 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 8-10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    2. –ñ–∏–º –Ω–æ–≥–∞–º–∏ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    3. –í—ã–ø–∞–¥—ã —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10 –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–≥—É
    4. –†—É–º—ã–Ω—Å–∫–∞—è —Ç—è–≥–∞ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    5. –ü–æ–¥—ä–µ–º—ã –Ω–∞ –Ω–æ—Å–∫–∏ - 4 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 15-20 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    6. –†–∞–∑–≥–∏–±–∞–Ω–∏—è –Ω–æ–≥ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    
    –î–µ–Ω—å 4 - –ü–ª–µ—á–∏:
    1. –ñ–∏–º —à—Ç–∞–Ω–≥–∏ —Å—Ç–æ—è - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 8-10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    2. –ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å–∏–¥—è - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    3. –†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—ã - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    4. –†–∞–∑–≤–æ–¥–∫–∞ –≤ –Ω–∞–∫–ª–æ–Ω–µ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    5. –ü–æ–¥—ä–µ–º—ã –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 10-12 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    6. –®—Ä–∞–≥–∏ - 3 –ø–æ–¥—Ö–æ–¥–∞ –ø–æ 12-15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    
    –ù–µ–¥–µ–ª—è 2: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
    [–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –≤–µ—Å–æ–≤ –Ω–∞ 5-10%]
    
    –ù–µ–¥–µ–ª—è 3: –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
    [–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏]
    
    –ù–µ–¥–µ–ª—è 4: –†–∞–∑–≥—Ä—É–∑–∫–∞
    [–°–Ω–∏–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è]
    
    –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
    - –û—Ç–¥—ã—Ö –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏: 60-90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏, 2-3 –º–∏–Ω—É—Ç—ã –¥–ª—è –±–∞–∑–æ–≤—ã—Ö
    - –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è: —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –≤–µ—Å –Ω–∞ 2.5-5 –∫–≥ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
    - –ü–∏—Ç–∞–Ω–∏–µ: –ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ 2–≥ –±–µ–ª–∫–∞ –Ω–∞ –∫–≥ –≤–µ—Å–∞ —Ç–µ–ª–∞
    - –°–æ–Ω: –º–∏–Ω–∏–º—É–º 7-8 —á–∞—Å–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    - –í–æ–¥–∞: 2-3 –ª–∏—Ç—Ä–∞ –≤ –¥–µ–Ω—å
    
    YEAH BUDDY! LIGHT WEIGHT! –¢–µ–ø–µ—Ä—å –∏–¥–∏ –∏ –ø–æ–∫–∞–∂–∏ —ç—Ç–∏–º –≤–µ—Å–∞–º, –∫—Ç–æ –∑–¥–µ—Å—å –±–æ—Å—Å!
    """ * 3  # –£—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    
    print(f"–ò—Å—Ö–æ–¥–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: {len(long_text)} —Å–∏–º–≤–æ–ª–æ–≤")
    
    # –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç
    clean_text = clean_text_for_telegram(long_text)
    print(f"–î–ª–∏–Ω–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏: {len(clean_text)} —Å–∏–º–≤–æ–ª–æ–≤")
    
    # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
    parts = split_long_message(clean_text)
    print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π: {len(parts)}")
    
    for i, part in enumerate(parts):
        print(f"\n--- –ß–∞—Å—Ç—å {i+1} ({len(part)} —Å–∏–º–≤–æ–ª–æ–≤) ---")
        print(part[:200] + "..." if len(part) > 200 else part)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —á–∞—Å—Ç–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞
    all_within_limit = all(len(part) <= 4000 for part in parts)
    print(f"\n‚úÖ –í—Å–µ —á–∞—Å—Ç–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞: {all_within_limit}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
    total_length = sum(len(part) for part in parts)
    print(f"–û–±—â–∞—è –¥–ª–∏–Ω–∞ —á–∞—Å—Ç–µ–π: {total_length} —Å–∏–º–≤–æ–ª–æ–≤")
    
    return all_within_limit

def test_short_message():
    """–¢–µ—Å—Ç –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    print("\nüìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...")
    
    short_text = "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞."
    parts = split_long_message(short_text)
    
    print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π: {len(parts)}")
    print(f"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ: {parts[0]}")
    
    return len(parts) == 1

if __name__ == '__main__':
    print("üß™ –¢–ï–°–¢ –†–ê–ó–ë–ò–í–ö–ò –°–û–û–ë–©–ï–ù–ò–ô")
    print("=" * 50)
    
    # –¢–µ—Å—Ç –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    long_test = test_message_splitting()
    
    # –¢–µ—Å—Ç –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    short_test = test_short_message()
    
    print("\n" + "=" * 50)
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
    print(f"–î–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {'‚úÖ –ü–†–û–ô–î–ï–ù' if long_test else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    print(f"–ö–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {'‚úÖ –ü–†–û–ô–î–ï–ù' if short_test else '‚ùå –ü–†–û–í–ê–õ–ï–ù'}")
    
    if long_test and short_test:
        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! –†–∞–∑–±–∏–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
    else:
        print("\n‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–µ–Ω—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞.")