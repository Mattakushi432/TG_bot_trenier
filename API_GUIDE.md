# API Guide - IFBB Pro Dual-Coach AI

## –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

### 1. Telegram Bot Token

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
   - –í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "IFBB Pro Coach")
   - –í–≤–µ–¥–∏—Ç–µ username –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "bot", –Ω–∞–ø—Ä–∏–º–µ—Ä: "ifbb_pro_coach_bot")
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
5. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª `.env`:
   ```
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token
   ```

### 2. Google Gemini API Key

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google AI Studio](https://makersuite.google.com/app/apikey)
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç Google
3. –ù–∞–∂–º–∏—Ç–µ "Create API Key"
4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–ª—é—á
6. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ —Ñ–∞–π–ª `.env`:
   ```
    GEMINI_API_KEY=your_gemini_api_key
   ```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ –≤ Telegram

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã BotFather

```
/setname - –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è –±–æ—Ç–∞
/setdescription - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
/setabouttext - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç "–û –±–æ—Ç–µ"
/setuserpic - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –±–æ—Ç–∞
/setcommands - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ–Ω—é –∫–æ–º–∞–Ω–¥
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ò–º—è –±–æ—Ç–∞:**
```
IFBB Pro Dual-Coach AI
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```
üèÜ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-—Ç—Ä–µ–Ω–µ—Ä —Å –¥–≤–æ–π–Ω–æ–π –ª–∏—á–Ω–æ—Å—Ç—å—é: –†–æ–Ω–Ω–∏ –ö–æ—É–ª–º–∞–Ω –¥–ª—è –º—É–∂—á–∏–Ω, –î–∂–µ–Ω–µ—Ç –õ–∞–π–æ–≥ –¥–ª—è –∂–µ–Ω—â–∏–Ω. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –ø–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –æ—Ç –Ω–æ–≤–∏—á–∫–∞ –¥–æ —É—Ä–æ–≤–Ω—è Olympia.
```

**–û –±–æ—Ç–µ:**
```
üèãÔ∏è –ß—Ç–æ —è —É–º–µ—é:
‚Ä¢ –°–æ–∑–¥–∞—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ 4 –Ω–µ–¥–µ–ª–∏
‚Ä¢ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é —Ç–æ—á–Ω–æ–µ –ö–ë–ñ–£ –∏ –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è
‚Ä¢ –ü–æ–¥–±–∏—Ä–∞—é —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚Ä¢ –†–∞–±–æ—Ç–∞—é –∫–∞–∫ –†–æ–Ω–Ω–∏ –ö–æ—É–ª–º–∞–Ω (–¥–ª—è –º—É–∂—á–∏–Ω) –∏–ª–∏ –î–∂–µ–Ω–µ—Ç –õ–∞–π–æ–≥ (–¥–ª—è –∂–µ–Ω—â–∏–Ω)

üéØ –¶–µ–ª–∏: –æ—Ç –ø–æ–¥—Ç—è–Ω—É—Ç–æ–≥–æ —Ç–µ–ª–∞ –¥–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º
üìç –õ–æ–∫–∞—Ü–∏–∏: –∑–∞–ª –∏–ª–∏ –¥–æ–º
üß¨ –ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥: —Ñ–æ—Ä–º—É–ª—ã BMR/TDEE, –ø–µ—Ä–∏–æ–¥–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è

–ù–∞—á–Ω–∏ —Å –∫–æ–º–∞–Ω–¥—ã /start
```

**–ö–æ–º–∞–Ω–¥—ã –º–µ–Ω—é:**
```
start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º
reset - –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
```

## –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API

### Telegram Bot API

- **–°–æ–æ–±—â–µ–Ω–∏—è**: –î–æ 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **–†–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è**: –î–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤
- **–§–∞–π–ª—ã**: –î–æ 50 –ú–ë
- **Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: –î–æ 100 –∫–Ω–æ–ø–æ–∫

### Google Gemini API

- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ**: 
  - 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
  - 1500 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- **–†–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞**: –î–æ 30,720 —Å–∏–º–≤–æ–ª–æ–≤
- **–†–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**: –î–æ 2048 —Ç–æ–∫–µ–Ω–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Telegram

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ [@BotFather]:
```
/mybots ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ ‚Üí Bot Settings ‚Üí Statistics
```

### Google AI Studio

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ [Google AI Studio](https://makersuite.google.com/app/apikey):
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
- –û—à–∏–±–∫–∏ API

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ Telegram

```python
# –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Å–∏–º–≤–æ–ª–æ–≤
if len(message) > 4096:
    # –†–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ –∏–ª–∏ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å

# –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
except telegram.error.RetryAfter as e:
    time.sleep(e.retry_after)

# –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
except telegram.error.Forbidden:
    # –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ Gemini

```python
# –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
except google.api_core.exceptions.ResourceExhausted:
    # –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback

# –ù–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
except google.api_core.exceptions.InvalidArgument:
    # –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É

# –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
except google.api_core.exceptions.ServiceUnavailable:
    # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

```python
# –ö—ç—à –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
response_cache = {}

def get_cached_response(user_id, query_type):
    cache_key = f"{user_id}_{query_type}"
    if cache_key in response_cache:
        return response_cache[cache_key]
    return None
```

### –ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

```python
# –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
def batch_update_users(user_updates):
    with sqlite3.connect(DATABASE_PATH) as conn:
        cursor = conn.cursor()
        cursor.executemany(
            "UPDATE users SET weight = ? WHERE user_id = ?",
            user_updates
        )
        conn.commit()
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
async def handle_long_operation(update, context):
    await update.message.reply_text("‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...")
    
    # –î–ª–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤ —Ñ–æ–Ω–µ
    result = await asyncio.create_task(
        generate_workout_plan(user_data)
    )
    
    await update.message.reply_text(result)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ API –∫–ª—é—á–µ–π

```bash
# –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª—ã
echo ".env" >> .gitignore

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
export TELEGRAM_BOT_TOKEN="your_token"
export GEMINI_API_KEY="your_key"
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
def validate_user_input(data):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
    if not (16 <= data.get('age', 0) <= 80):
        raise ValueError("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–∞
    if not (40 <= data.get('weight', 0) <= 200):
        raise ValueError("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å")
    
    # –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
    data['injuries'] = html.escape(data.get('injuries', ''))
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```python
from collections import defaultdict
import time

user_last_request = defaultdict(float)
REQUEST_COOLDOWN = 2  # —Å–µ–∫—É–Ω–¥—ã

def check_rate_limit(user_id):
    now = time.time()
    if now - user_last_request[user_id] < REQUEST_COOLDOWN:
        return False
    user_last_request[user_id] = now
    return True
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_token
GEMINI_API_KEY=your_key

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
DATABASE_PATH=/app/data/users.db
LOG_LEVEL=INFO
MAX_USERS=10000
CACHE_TTL=3600
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
CMD ["python", "main.py"]
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```python
import logging
import sentry_sdk

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler()
    ]
)

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
sentry_sdk.init(dsn="your_sentry_dsn")
```

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ webhook –≤–º–µ—Å—Ç–æ polling
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ load balancer
- –í—ã–Ω–µ—Å–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_users_user_id ON users(user_id);
CREATE INDEX idx_progress_user_id ON progress(user_id);
CREATE INDEX idx_progress_date ON progress(date);

-- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º
CREATE TABLE progress_2024 PARTITION OF progress
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import redis

# Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
redis_client = redis.Redis(host='localhost', port=6379, db=0)

def cache_user_data(user_id, data, ttl=3600):
    redis_client.setex(
        f"user:{user_id}", 
        ttl, 
        json.dumps(data)
    )
```